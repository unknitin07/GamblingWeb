<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Stake Clone</title>
  <!-- Include auth-api.js -->
  <script src="scripts/auth-api.js"></script>
  <link rel="stylesheet" href="styles/login.css">
</head>
<body>
  <header class="header">
    <a href="/" class="header-brand">
      <svg width="48" height="48" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="headerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#38bdf8;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
          </linearGradient>
        </defs>
        <rect width="64" height="64" rx="14" fill="url(#headerGradient)" />
        <path d="M20 32 L32 20 L44 32 L32 44 Z" fill="rgba(255,255,255,0.9)" />
      </svg>
      <span class="header-logo-text">STAKE CLONE</span>
    </a>
    <nav class="header-nav">
      <a href="/">Home</a>
      <a href="/games">Games</a>
      <a href="/promotions">Promotions</a>
      <a href="/support">Support</a>
    </nav>
  </header>

  <div class="login-container">
    <div class="brand-section">
      <div class="brand-logo">
        <svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="brandGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#38bdf8;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
            </linearGradient>
          </defs>
          <rect width="64" height="64" rx="14" fill="url(#brandGradient)" />
          <path d="M20 32 L32 20 L44 32 L32 44 Z" fill="rgba(255,255,255,0.9)" />
        </svg>
      </div>
      <h1 class="brand-title">STAKE CLONE</h1>
      <p class="brand-subtitle">Fast, provably fair gaming</p>
    </div>

    <div class="login-card">
      <div class="card-header">
        <h2 class="card-title">Welcome Back</h2>
        <p class="card-description">Sign in to your account to continue</p>
      </div>

      <div id="errorMessage" class="error-message"></div>

      <form id="loginForm">
        <div class="form-group">
          <label for="email" class="form-label">Email or Username</label>
          <input type="text" id="email" class="form-input" placeholder="Enter your email or username" required />
        </div>

        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <div class="password-wrapper">
            <input type="password" id="password" class="form-input" placeholder="Enter your password" required />
            <button type="button" class="password-toggle" id="togglePassword">üëÅÔ∏è</button>
          </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <div class="checkbox-group" style="margin-bottom: 0;">
            <label class="checkbox-wrapper">
              <input type="checkbox" id="remember" class="checkbox-input" />
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">Remember me</span>
            </label>
          </div>
          <a href="#" class="forgot-link" style="margin: 0;">Forgot password?</a>
        </div>

        <button type="submit" class="btn btn-primary" id="loginButton">
          <span id="buttonText">Sign In</span>
        </button>
      </form>

      <div class="footer-features">
        <div class="feature-item">
          <div class="feature-icon">üîí</div>
          <div class="feature-text">Secure & Safe</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">‚ö°</div>
          <div class="feature-text">Instant Play</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üë§</div>
          <div class="feature-text">24/7 Support</div>
        </div>
      </div>

      <div class="footer-text">Don't have an account?</div>
      <button type="button" class="btn btn-secondary" id="registerButton" style="margin-top: 12px;">Sign Up</button>
    </div>
  </div>

  <script>
    // ======================================
    // USING AUTH API
    // ======================================
    
    // Check if already logged in
    if (authAPI.isAuthenticated()) {
      // Optionally verify token and redirect
      window.location.href = '/dashboard.html';
    }

    // Form elements
    const form = document.getElementById('loginForm');
    const btn = document.getElementById('loginButton');
    const btnText = document.getElementById('buttonText');
    const err = document.getElementById('errorMessage');

    // Helper function
    function showError(msg) {
      err.textContent = msg;
      err.classList.add('show');
      setTimeout(() => err.classList.remove('show'), 5000);
    }

    // Password toggle
    document.getElementById('togglePassword').addEventListener('click', () => {
      const input = document.getElementById('password');
      input.type = input.type === 'password' ? 'text' : 'password';
    });

    // FORM SUBMIT - USING AUTH API
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const emailOrUsername = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const remember = document.getElementById('remember').checked;

      // CLIENT-SIDE VALIDATION
      if (!emailOrUsername || !password) {
        showError('Please fill in all fields');
        return;
      }

      // SHOW LOADING
      btn.disabled = true;
      btnText.innerHTML = '<span class="spinner"></span>';

      try {
        // CALL AUTH API
        const result = await authAPI.login(emailOrUsername, password, remember);

        if (result.success) {
          // Success - redirect to dashboard
          window.location.href = '/dashboard.html';
        } else {
          showError(result.error || 'Login failed. Please check your credentials.');
        }
      } catch (error) {
        console.error('Login error:', error);
        showError('An unexpected error occurred. Please try again.');
      } finally {
        btn.disabled = false;
        btnText.textContent = 'Sign In';
      }
    });

    // Register button
    document.getElementById('registerButton').addEventListener('click', () => {
      window.location.href = '/register.html';
    });

    // Forgot password link
    document.querySelector('.forgot-link').addEventListener('click', (e) => {
      e.preventDefault();
      window.location.href = '/forgot-password.html';
    });
  </script>
</body>
</html>
